schema_version: arch-map.v1
meta:
  generated_at: "2026-01-16T04:05:00.000000+00:00"
  generator: update_architecture_docs.py
  generator_version: 2.0.0
  source_commit: current_development
  freshness_days: 7
  notes:
  - Single source of truth for actifix architecture contexts
  - Keep aligned with quality gates and architecture compliance
  - Auto-generated - includes persistence and testing subsystems
  - Run record-error simple ticket attack to generate 500 tickets
domains:
- id: runtime
  summary: Bootstrap, configuration, state management, lifecycle
- id: infra
  summary: Logging, health monitoring, persistence, observability
- id: core
  summary: Error handling, ticket management, automated remediation
- id: security
  summary: Authentication, authorization, rate limiting, secrets management
- id: tooling
  summary: Testing, quality assurance, architecture validation
- id: plugins
  summary: Plugin discovery, validation, and lifecycle orchestration
modules:
- id: bootstrap.main
  domain: runtime
  owner: runtime
  summary: Main entrypoint orchestrating system initialization and process management
  entrypoints:
  - src/actifix/main.py
  - src/actifix/bootstrap.py
  contracts:
  - ensures environment setup
  - launches core services in correct order
  depends_on:
  - runtime.config
  - infra.logging
  - infra.health
  - infra.persistence.database
- id: runtime.api
  domain: runtime
  owner: runtime
  summary: Public API surface and package exports
  entrypoints:
  - src/actifix/__init__.py
  - src/actifix/api.py
  contracts:
  - expose stable API
  - centralize package exports
  depends_on:
  - core.raise_af
  - bootstrap.main
  - runtime.state
  - infra.health
- id: runtime.config
  domain: runtime
  owner: runtime
  summary: Configuration management and environment normalization
  entrypoints:
  - src/actifix/config.py
  contracts:
  - centralize configuration
  - validate environment state
  - fail fast on invalid config
  depends_on:
  - infra.logging
- id: runtime.state
  domain: runtime
  owner: runtime
  summary: State management and persistence paths
  entrypoints:
  - src/actifix/state_paths.py
  contracts:
  - atomic state operations
  - recoverable state management
  depends_on:
  - infra.logging
- id: runtime.dock_icon
  domain: runtime
  owner: runtime
  summary: macOS dock icon helper utilities
  entrypoints:
  - src/actifix/dock_icon.py
  contracts:
  - safe no-op on non-macOS
  - avoid side effects on import
  depends_on: []
- id: infra.logging
  domain: infra
  owner: infra
  summary: Centralized logging system with correlation tracking
  entrypoints:
  - src/actifix/log_utils.py
  contracts:
  - single logging sink
  - structured error logging
  - correlation IDs
  depends_on: []
- id: infra.health
  domain: infra
  owner: infra
  summary: Health monitoring and system status tracking
  entrypoints:
  - src/actifix/health.py
  contracts:
  - detect degraded states
  - surface system health
  - continuous monitoring
  depends_on:
  - infra.logging
- id: infra.persistence.atomic
  domain: infra
  owner: persistence
  summary: Atomic file operations for durability and safety
  entrypoints:
  - src/actifix/persistence/atomic.py
  contracts:
  - atomic writes
  - append with size limits
  - idempotent operations
  depends_on:
  - infra.logging
- id: infra.persistence.api
  domain: infra
  owner: persistence
  summary: Persistence package public API and exports
  entrypoints:
  - src/actifix/persistence/__init__.py
  contracts:
  - re-export persistence interfaces
  - keep API stable
  depends_on:
  - infra.persistence.atomic
  - infra.persistence.storage
  - infra.persistence.queue
  - infra.persistence.manager
  - infra.persistence.health
  - infra.persistence.paths
- id: infra.persistence.storage
  domain: infra
  owner: persistence
  summary: Storage backend abstraction (file, memory, JSON)
  entrypoints:
  - src/actifix/persistence/storage.py
  contracts:
  - pluggable storage backends
  - consistent interface
  - error handling
  depends_on:
  - infra.logging
  - infra.persistence.atomic
- id: infra.persistence.queue
  domain: infra
  owner: persistence
  summary: Persistence queue for asynchronous operations
  entrypoints:
  - src/actifix/persistence/queue.py
  contracts:
  - durable operation queue
  - replay capability
  - entry pruning
  depends_on:
  - infra.logging
  - infra.persistence.storage
- id: infra.persistence.manager
  domain: infra
  owner: persistence
  summary: High-level persistence management with transactions
  entrypoints:
  - src/actifix/persistence/manager.py
  contracts:
  - transactional operations
  - document management
  - queue integration
  depends_on:
  - infra.logging
  - infra.persistence.storage
  - infra.persistence.queue
- id: infra.persistence.health
  domain: infra
  owner: persistence
  summary: Storage health checks and corruption detection
  entrypoints:
  - src/actifix/persistence/health.py
  contracts:
  - storage validation
  - integrity verification
  - corruption detection
  depends_on:
  - infra.logging
  - infra.persistence.storage
- id: infra.persistence.paths
  domain: infra
  owner: persistence
  summary: Storage path configuration and management
  entrypoints:
  - src/actifix/persistence/paths.py
  contracts:
  - centralized path configuration
  - directory helpers
  depends_on:
  - infra.logging
- id: infra.persistence.event_repo
  domain: infra
  owner: persistence
  summary: Lightweight event repository for diagnostics and testing helpers
  entrypoints:
  - src/actifix/persistence/event_repo.py
  contracts:
  - store simple events for instrumentation
  - provide resettable hooks for tests
  depends_on: []
- id: infra.persistence.database
  domain: infra
  owner: persistence
  summary: SQLite database backend with connection pooling and schema management
  entrypoints:
  - src/actifix/persistence/database.py
  contracts:
  - thread-safe connection pooling
  - automatic schema migrations
  - WAL mode for concurrency
  depends_on:
  - infra.logging
- id: infra.persistence.ticket_repo
  domain: infra
  owner: persistence
  summary: Ticket repository with CRUD operations and locking
  entrypoints:
  - src/actifix/persistence/ticket_repo.py
  contracts:
  - database CRUD for tickets
  - lease-based locking
  - duplicate prevention
  depends_on:
  - infra.logging
  - infra.persistence.database
  - core.raise_af
- id: core.raise_af
  domain: core
  owner: core
  summary: Error capture and ticket creation system (persists entries into the SQLite ticket repository)
  entrypoints:
  - src/actifix/raise_af.py
  contracts:
  - capture all errors
  - create structured tickets persisted in `data/actifix.db`
  - prevent duplication
  depends_on:
  - infra.logging
  - core.quarantine
  - infra.persistence.ticket_repo
  - security.ticket_throttler
- id: core.do_af
  domain: core
  owner: core
  summary: Ticket processing and automated remediation
  entrypoints:
  - src/actifix/do_af.py
  contracts:
  - process tickets systematically
  - integrate with AI systems
  - validate fixes
  depends_on:
  - infra.logging
  - core.raise_af
  - core.ai_client
  - infra.persistence.ticket_repo
- id: core.quarantine
  domain: core
  owner: core
  summary: Error isolation and safe failure handling
  entrypoints:
  - src/actifix/quarantine.py
  contracts:
  - isolate corrupted state
  - prevent system-wide failures
  depends_on:
  - infra.logging
  - runtime.state
- id: tooling.testing.system
  domain: tooling
  owner: testing
  summary: System-level test framework and test builder
  entrypoints:
  - src/actifix/testing/system.py
  contracts:
  - build system tests
  - validate dependencies
  - enforce architecture
  depends_on:
  - infra.logging
  - runtime.state
- id: tooling.testing.reporting
  domain: tooling
  owner: testing
  summary: Test cycle reporting and progress tracking
  entrypoints:
  - src/actifix/testing/reporting.py
  contracts:
  - test inventory
  - numbered progress
  - cycle logs
  depends_on:
  - infra.logging
  - tooling.testing.system
- id: tooling.testing
  domain: tooling
  owner: tooling
  summary: Quality assurance and testing framework
  entrypoints:
  - src/actifix/testing/__init__.py
  - test/test_runner.py
  contracts:
  - enforce quality gates
  - maintain test coverage
  - accelerate coverage cycles by enabling parallel pytest-xdist runs when available
  - validate architecture
  depends_on:
  - bootstrap.main
  - infra.logging
  - core.raise_af
  - tooling.testing.system
  - tooling.testing.reporting
- id: tooling.simple_ticket_attack
  domain: tooling
  owner: tooling
  summary: Batch creation of lightweight tickets through the Actifix pipeline
  entrypoints:
  - src/actifix/simple_ticket_attack.py
  contracts:
  - generate sequences of simple tickets with record_error
  - keep `data/actifix.db` untouched by manual edits (use the API instead)
  - reuse the core ticketing flow for experiments
  depends_on:
  - core.raise_af
  - runtime.state
- id: tooling.bounce
  domain: tooling
  owner: tooling
  summary: Script to stop and restart Actifix processes
  entrypoints:
  - scripts/bounce.py
  contracts:
  - stop existing frontend and API processes
  - relaunch application via scripts/start.py with Raise_AF gate
  depends_on:
  - bootstrap.main
- id: core.ai_client
  domain: core
  owner: core
  summary: Multi-provider AI integration with automatic fallback chain
  entrypoints:
  - src/actifix/ai_client.py
  contracts:
  - Claude Code local auth detection
  - Claude API integration
  - OpenAI GPT-4 Turbo integration
  - Ollama local model support
  - Free alternative user prompts
  - Automatic provider fallback
  - Cost tracking and logging
  depends_on:
  - runtime.config
  - infra.logging
  - runtime.state
- id: core.error_taxonomy
  domain: core
  owner: core
  summary: Enhanced error classification and taxonomy system
  entrypoints:
  - src/actifix/error_taxonomy.py
  contracts:
  - sophisticated error pattern matching
  - priority classification based on error characteristics
  - remediation hints generation
  - extensible pattern system
  depends_on:
  - core.raise_af
- id: core.recovery
  domain: core
  owner: core
  summary: State recovery and transaction rollback mechanisms
  entrypoints:
  - src/actifix/recovery.py
  contracts:
  - recover from incomplete operations
  - rollback failed transactions
  - maintain consistent state
  depends_on:
  - infra.logging
  - infra.persistence.manager
- id: security.api
  domain: security
  owner: security
  summary: Security module public API and exports
  entrypoints:
  - src/actifix/security/__init__.py
  contracts:
  - re-export security interfaces
  - centralize security exports
  depends_on:
  - security.auth
  - security.credentials
  - security.rate_limiter
  - security.secrets_scanner
- id: security.auth
  domain: security
  owner: security
  summary: Authentication and authorization implementation
  entrypoints:
  - src/actifix/security/auth.py
  contracts:
  - JWT token validation
  - RBAC enforcement
  - session management
  depends_on:
  - infra.logging
  - security.credentials
- id: security.credentials
  domain: security
  owner: security
  summary: Credential management and password hashing
  entrypoints:
  - src/actifix/security/credentials.py
  contracts:
  - PBKDF2 password hashing
  - credential storage and retrieval
  - secure comparison functions
  depends_on:
  - infra.logging
- id: security.rate_limiter
  domain: security
  owner: security
  summary: Token bucket rate limiting per minute/hour/day
  entrypoints:
  - src/actifix/security/rate_limiter.py
  contracts:
  - enforce per-minute limits
  - enforce per-hour limits
  - enforce per-day limits
  - track request metrics
  depends_on:
  - infra.logging
  - runtime.config
- id: security.secrets_scanner
  domain: security
  owner: security
  summary: Secrets and sensitive data detection
  entrypoints:
  - src/actifix/security/secrets_scanner.py
  contracts:
  - detect API keys in logs
  - detect credentials in output
  - sanitize sensitive data
  depends_on:
  - infra.logging
- id: security.ticket_throttler
  domain: security
  owner: security
  summary: Ticket flood protection with priority-aware throttling and emergency braking
  entrypoints:
  - src/actifix/security/ticket_throttler.py
  contracts:
  - enforce per-priority ticket rate limits for P2/P3/P4
  - activate an emergency brake when floods exceed configured thresholds
  - persist throttle history for durability and observability
  depends_on:
  - runtime.state
  - core.raise_af
- id: plugins.permissions
  domain: plugins
  owner: plugins
  summary: Plugin permission and capability management
  entrypoints:
  - src/actifix/plugins/permissions.py
  contracts:
  - define plugin permissions
  - enforce capability-based security
  - validate plugin access
  depends_on:
  - plugins.protocol
  - security.auth
- id: plugins.protocol
  domain: plugins
  owner: plugins
  summary: Standard metadata and health contracts for plugins
  entrypoints:
  - src/actifix/plugins/protocol.py
  contracts:
  - define plugin metadata and health contracts
  depends_on: []
- id: plugins.registry
  domain: plugins
  owner: plugins
  summary: Registry managing plugin lifecycle and observability
  entrypoints:
  - src/actifix/plugins/registry.py
  contracts:
  - enforce one-time registration per plugin name
  - log lifecycle events through centralized logging
  - expose context helpers for temporary plugins
  depends_on:
  - infra.logging
  - plugins.protocol
- id: plugins.validation
  domain: plugins
  owner: plugins
  summary: Metadata validation and capability enforcement
  entrypoints:
  - src/actifix/plugins/validation.py
  contracts:
  - validate plugin metadata schema before registration
  - enforce semantic versioning for plugin releases
  - log and surface validation failures for diagnostics
  depends_on:
  - infra.logging
  - plugins.protocol
- id: plugins.sandbox
  domain: plugins
  owner: plugins
  summary: Isolation layer and safe registration wrapper
  entrypoints:
  - src/actifix/plugins/sandbox.py
  contracts:
  - contain plugin failures during register/unregister
  - report load failures via raise_af with structured tickets
  - keep registry state consistent when plugins crash
  depends_on:
  - core.raise_af
  - infra.logging
  - plugins.registry
  - plugins.validation
- id: plugins.loader
  domain: plugins
  owner: plugins
  summary: Entry-point discovery, instantiation, and registration
  entrypoints:
  - src/actifix/plugins/loader.py
  contracts:
  - discover plugins through actifix.plugins entry points
  - validate and sandbox every plugin before registration
  - publish load summaries and failure reasons
  depends_on:
  - core.raise_af
  - infra.logging
  - plugins.registry
  - plugins.validation
  - plugins.sandbox
- id: plugins.api
  domain: plugins
  owner: plugins
  summary: Public API exports for plugin authors
  entrypoints:
  - src/actifix/plugins/__init__.py
  contracts:
  - re-export plugin protocol helpers and registry references
  - document activation steps for entry-point based extensions
  depends_on:
  - plugins.protocol
  - plugins.registry
- id: plugins.builtin
  domain: plugins
  owner: plugins
  summary: Self-testing plugin that exercises plugin lifecycle and health
  entrypoints:
  - src/actifix/plugins/builtin.py
  contracts:
  - verify registry sandboxing and health checks
  - provide a built-in example plugin for documentation
  depends_on:
  - plugins.registry
  - plugins.protocol
contracts:
- id: contract.logging
  summary: All modules must log via centralized logging system with correlation IDs
  applies_to:
  - bootstrap.main
  - runtime.config
  - core.raise_af
  - core.do_af
  - infra.health
  - infra.persistence.atomic
  - infra.persistence.storage
  - infra.persistence.queue
  - infra.persistence.manager
  - tooling.testing
  - plugins.registry
  - plugins.validation
  - plugins.sandbox
  - plugins.loader
  - plugins.api
  enforced_by:
  - infra.logging
- id: contract.error_isolation
  summary: Error handling must isolate failures and prevent system-wide corruption
  applies_to:
  - core.raise_af
  - core.do_af
  - plugins.sandbox
  enforced_by:
  - core.quarantine
- id: contract.quality_gates
  summary: All components must pass quality gates and maintain architecture compliance
  applies_to:
  - bootstrap.main
  - runtime.config
  - runtime.state
  - core.raise_af
  - core.do_af
  - infra.persistence.manager
  - plugins.loader
  - plugins.validation
  enforced_by:
  - tooling.testing
  - infra.health
- id: contract.durability
  summary: All persistence operations must be atomic and recoverable
  applies_to:
  - infra.persistence.atomic
  - infra.persistence.storage
  - infra.persistence.queue
  - infra.persistence.manager
  enforced_by:
  - infra.persistence.atomic
  - infra.persistence.health
- id: contract.plugin_integrity
  summary: Plugin metadata, lifecycle, and health must always be validated
  applies_to:
  - plugins.protocol
  - plugins.registry
  - plugins.validation
  - plugins.sandbox
  - plugins.loader
  - plugins.api
  - plugins.builtin
  enforced_by:
  - infra.logging
  - tooling.testing
